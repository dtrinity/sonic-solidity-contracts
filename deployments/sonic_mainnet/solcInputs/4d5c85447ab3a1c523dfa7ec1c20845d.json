{
  "language": "Solidity",
  "sources": {
    "contracts/oracle_aggregator/helper/ChainlinkDecimalDownscaler.sol": {
      "content": "// SPDX-License-Identifier: MIT\n/* ———————————————————————————————————————————————————————————————————————————————— *\n *    _____     ______   ______     __     __   __     __     ______   __  __       *\n *   /\\  __-.  /\\__  _\\ /\\  == \\   /\\ \\   /\\ \"-.\\ \\   /\\ \\   /\\__  _\\ /\\ \\_\\ \\      *\n *   \\ \\ \\/\\ \\ \\/_/\\ \\/ \\ \\  __<   \\ \\ \\  \\ \\ \\-.  \\  \\ \\ \\  \\/_/\\ \\/ \\ \\____ \\     *\n *    \\ \\____-    \\ \\_\\  \\ \\_\\ \\_\\  \\ \\_\\  \\ \\_\\\\\"\\_\\  \\ \\_\\    \\ \\_\\  \\/\\_____\\    *\n *     \\/____/     \\/_/   \\/_/ /_/   \\/_/   \\/_/ \\/_/   \\/_/     \\/_/   \\/_____/    *\n *                                                                                  *\n * ————————————————————————————————— dtrinity.org ————————————————————————————————— *\n *                                                                                  *\n *                                         ▲                                        *\n *                                        ▲ ▲                                       *\n *                                                                                  *\n * ———————————————————————————————————————————————————————————————————————————————— *\n * dTRINITY Protocol: https://github.com/dtrinity                                   *\n * ———————————————————————————————————————————————————————————————————————————————— */\n\npragma solidity ^0.8.20;\n\nimport \"../interface/chainlink/IAggregatorV3Interface.sol\";\n\n/**\n * @title ChainlinkDecimalDownscaler\n * @notice Converts Chainlink price feeds from higher to lower decimal precisions (downscaling only)\n * @dev Implements AggregatorV3Interface to mimic being a Chainlink price feed\n */\ncontract ChainlinkDecimalDownscaler is AggregatorV3Interface {\n    /// @notice Original Chainlink price feed\n    AggregatorV3Interface public immutable sourceFeed;\n\n    /// @notice Original decimals from the source feed\n    uint8 public immutable sourceDecimals;\n\n    /// @notice Target decimals for price conversion\n    uint8 public immutable override decimals;\n\n    /// @notice Scaling factor to convert between source and target decimals\n    int256 private immutable scalingFactor;\n\n    /**\n     * @notice Error thrown when target decimals exceed source decimals\n     */\n    error InvalidDecimalsUpscaleNotSupported();\n\n    /**\n     * @notice Constructor to initialize the decimal downscaler\n     * @param _sourceFeed Address of the source Chainlink price feed\n     * @param _targetDecimals Target decimal precision (must be less than or equal to source decimals)\n     */\n    constructor(address _sourceFeed, uint8 _targetDecimals) {\n        sourceFeed = AggregatorV3Interface(_sourceFeed);\n        sourceDecimals = sourceFeed.decimals();\n        decimals = _targetDecimals;\n\n        // We only support downscaling (reducing precision), not upscaling\n        if (_targetDecimals > sourceDecimals) {\n            revert InvalidDecimalsUpscaleNotSupported();\n        }\n\n        // Calculate the scaling factor to convert from source to target decimals\n        uint8 decimalDifference = sourceDecimals - _targetDecimals;\n        scalingFactor = int256(10 ** decimalDifference);\n    }\n\n    /**\n     * @notice Returns the description of the original feed\n     * @return Description string\n     */\n    function description() external view override returns (string memory) {\n        return sourceFeed.description();\n    }\n\n    /**\n     * @notice Returns the version of the original feed\n     * @return Version number\n     */\n    function version() external view override returns (uint256) {\n        return sourceFeed.version();\n    }\n\n    /**\n     * @notice Gets data for a specific round\n     * @param _roundId The round ID to retrieve data for\n     * @return roundId The round ID\n     * @return answer The price with adjusted decimals\n     * @return startedAt The timestamp when the round started\n     * @return updatedAt The timestamp when the round was updated\n     * @return answeredInRound The round in which the answer was computed\n     */\n    function getRoundData(\n        uint80 _roundId\n    )\n        external\n        view\n        override\n        returns (\n            uint80 roundId,\n            int256 answer,\n            uint256 startedAt,\n            uint256 updatedAt,\n            uint80 answeredInRound\n        )\n    {\n        (roundId, answer, startedAt, updatedAt, answeredInRound) = sourceFeed\n            .getRoundData(_roundId);\n        answer = answer / scalingFactor;\n    }\n\n    /**\n     * @notice Gets data for the latest round\n     * @return roundId The round ID\n     * @return answer The price with adjusted decimals\n     * @return startedAt The timestamp when the round started\n     * @return updatedAt The timestamp when the round was updated\n     * @return answeredInRound The round in which the answer was computed\n     */\n    function latestRoundData()\n        external\n        view\n        override\n        returns (\n            uint80 roundId,\n            int256 answer,\n            uint256 startedAt,\n            uint256 updatedAt,\n            uint80 answeredInRound\n        )\n    {\n        (roundId, answer, startedAt, updatedAt, answeredInRound) = sourceFeed\n            .latestRoundData();\n        answer = answer / scalingFactor;\n    }\n}\n"
    },
    "contracts/oracle_aggregator/helper/ChainlinkDecimalUpscaler.sol": {
      "content": "// SPDX-License-Identifier: MIT\n/* ———————————————————————————————————————————————————————————————————————————————— *\n *    _____     ______   ______     __     __   __     __     ______   __  __       *\n *   /\\  __-.  /\\__  _\\ /\\  == \\   /\\ \\   /\\ \"-.\\ \\   /\\ \\   /\\__  _\\ /\\ \\_\\ \\      *\n *   \\ \\ \\/\\ \\ \\/_/\\ \\/ \\ \\  __<   \\ \\ \\  \\ \\ \\-.  \\  \\ \\ \\  \\/_/\\ \\/ \\ \\____ \\     *\n *    \\ \\____-    \\ \\_\\  \\ \\_\\ \\_\\  \\ \\_\\  \\ \\_\\\\\"\\_\\  \\ \\_\\    \\ \\_\\  \\/\\_____\\    *\n *     \\/____/     \\/_/   \\/_/ /_/   \\/_/   \\/_/ \\/_/   \\/_/     \\/_/   \\/_____/    *\n *                                                                                  *\n * ————————————————————————————————— dtrinity.org ————————————————————————————————— *\n *                                                                                  *\n *                                         ▲                                        *\n *                                        ▲ ▲                                       *\n *                                                                                  *\n * ———————————————————————————————————————————————————————————————————————————————— *\n * dTRINITY Protocol: https://github.com/dtrinity                                   *\n * ———————————————————————————————————————————————————————————————————————————————— */\n\npragma solidity ^0.8.20;\n\nimport \"../interface/chainlink/IAggregatorV3Interface.sol\";\n\n/**\n * @title ChainlinkDecimalUpscaler\n * @notice Converts Chainlink price feeds from lower to higher decimal precisions (upscaling only)\n * @dev Implements AggregatorV3Interface to mimic being a Chainlink price feed\n */\ncontract ChainlinkDecimalUpscaler is AggregatorV3Interface {\n    /// @notice Original Chainlink price feed\n    AggregatorV3Interface public immutable sourceFeed;\n\n    /// @notice Original decimals from the source feed\n    uint8 public immutable sourceDecimals;\n\n    /// @notice Target decimals for price conversion\n    uint8 public immutable override decimals;\n\n    /// @notice Scaling factor to convert between source and target decimals\n    int256 private immutable scalingFactor;\n\n    /**\n     * @notice Error thrown when target decimals are less than or equal to source decimals\n     */\n    error InvalidDecimalsDownscaleNotSupported();\n\n    /**\n     * @notice Constructor to initialize the decimal upscaler\n     * @param _sourceFeed Address of the source Chainlink price feed\n     * @param _targetDecimals Target decimal precision (must be greater than source decimals)\n     */\n    constructor(address _sourceFeed, uint8 _targetDecimals) {\n        sourceFeed = AggregatorV3Interface(_sourceFeed);\n        sourceDecimals = sourceFeed.decimals();\n        decimals = _targetDecimals;\n\n        // We only support upscaling (increasing precision), not downscaling\n        if (_targetDecimals <= sourceDecimals) {\n            revert InvalidDecimalsDownscaleNotSupported();\n        }\n\n        // Calculate the scaling factor to convert from source to target decimals\n        uint8 decimalDifference = _targetDecimals - sourceDecimals;\n        scalingFactor = int256(10 ** decimalDifference);\n    }\n\n    /**\n     * @notice Returns the description of the original feed\n     * @return Description string\n     */\n    function description() external view override returns (string memory) {\n        return sourceFeed.description();\n    }\n\n    /**\n     * @notice Returns the version of the original feed\n     * @return Version number\n     */\n    function version() external view override returns (uint256) {\n        return sourceFeed.version();\n    }\n\n    /**\n     * @notice Gets data for a specific round\n     * @param _roundId The round ID to retrieve data for\n     * @return roundId The round ID\n     * @return answer The price with adjusted decimals\n     * @return startedAt The timestamp when the round started\n     * @return updatedAt The timestamp when the round was updated\n     * @return answeredInRound The round in which the answer was computed\n     */\n    function getRoundData(\n        uint80 _roundId\n    )\n        external\n        view\n        override\n        returns (\n            uint80 roundId,\n            int256 answer,\n            uint256 startedAt,\n            uint256 updatedAt,\n            uint80 answeredInRound\n        )\n    {\n        (roundId, answer, startedAt, updatedAt, answeredInRound) = sourceFeed\n            .getRoundData(_roundId);\n        answer = answer * scalingFactor;\n    }\n\n    /**\n     * @notice Gets data for the latest round\n     * @return roundId The round ID\n     * @return answer The price with adjusted decimals\n     * @return startedAt The timestamp when the round started\n     * @return updatedAt The timestamp when the round was updated\n     * @return answeredInRound The round in which the answer was computed\n     */\n    function latestRoundData()\n        external\n        view\n        override\n        returns (\n            uint80 roundId,\n            int256 answer,\n            uint256 startedAt,\n            uint256 updatedAt,\n            uint80 answeredInRound\n        )\n    {\n        (roundId, answer, startedAt, updatedAt, answeredInRound) = sourceFeed\n            .latestRoundData();\n        answer = answer * scalingFactor;\n    }\n}\n"
    },
    "contracts/oracle_aggregator/interface/chainlink/IAggregatorV3Interface.sol": {
      "content": "// SPDX-License-Identifier: MIT\n/* ———————————————————————————————————————————————————————————————————————————————— *\n *    _____     ______   ______     __     __   __     __     ______   __  __       *\n *   /\\  __-.  /\\__  _\\ /\\  == \\   /\\ \\   /\\ \"-.\\ \\   /\\ \\   /\\__  _\\ /\\ \\_\\ \\      *\n *   \\ \\ \\/\\ \\ \\/_/\\ \\/ \\ \\  __<   \\ \\ \\  \\ \\ \\-.  \\  \\ \\ \\  \\/_/\\ \\/ \\ \\____ \\     *\n *    \\ \\____-    \\ \\_\\  \\ \\_\\ \\_\\  \\ \\_\\  \\ \\_\\\\\"\\_\\  \\ \\_\\    \\ \\_\\  \\/\\_____\\    *\n *     \\/____/     \\/_/   \\/_/ /_/   \\/_/   \\/_/ \\/_/   \\/_/     \\/_/   \\/_____/    *\n *                                                                                  *\n * ————————————————————————————————— dtrinity.org ————————————————————————————————— *\n *                                                                                  *\n *                                         ▲                                        *\n *                                        ▲ ▲                                       *\n *                                                                                  *\n * ———————————————————————————————————————————————————————————————————————————————— *\n * dTRINITY Protocol: https://github.com/dtrinity                                   *\n * ———————————————————————————————————————————————————————————————————————————————— */\n\npragma solidity ^0.8.20;\n\ninterface AggregatorV3Interface {\n    function decimals() external view returns (uint8);\n\n    function description() external view returns (string memory);\n\n    function version() external view returns (uint256);\n\n    // getRoundData and latestRoundData should both raise \"No data present\"\n    // if they do not have data to report, instead of returning unset values\n    // which could be misinterpreted as actual reported values.\n    function getRoundData(\n        uint80 _roundId\n    )\n        external\n        view\n        returns (\n            uint80 roundId,\n            int256 answer,\n            uint256 startedAt,\n            uint256 updatedAt,\n            uint80 answeredInRound\n        );\n\n    function latestRoundData()\n        external\n        view\n        returns (\n            uint80 roundId,\n            int256 answer,\n            uint256 startedAt,\n            uint256 updatedAt,\n            uint80 answeredInRound\n        );\n}\n"
    },
    "contracts/testing/oracle/MockChainlinkAggregator.sol": {
      "content": "// SPDX-License-Identifier: MIT\n/* ———————————————————————————————————————————————————————————————————————————————— *\n *    _____     ______   ______     __     __   __     __     ______   __  __       *\n *   /\\  __-.  /\\__  _\\ /\\  == \\   /\\ \\   /\\ \"-.\\ \\   /\\ \\   /\\__  _\\ /\\ \\_\\ \\      *\n *   \\ \\ \\/\\ \\ \\/_/\\ \\/ \\ \\  __<   \\ \\ \\  \\ \\ \\-.  \\  \\ \\ \\  \\/_/\\ \\/ \\ \\____ \\     *\n *    \\ \\____-    \\ \\_\\  \\ \\_\\ \\_\\  \\ \\_\\  \\ \\_\\\\\"\\_\\  \\ \\_\\    \\ \\_\\  \\/\\_____\\    *\n *     \\/____/     \\/_/   \\/_/ /_/   \\/_/   \\/_/   \\/_/ \\/_/   \\/_/     \\/_____/    *\n *                                                                                  *\n * ————————————————————————————————— dtrinity.org ————————————————————————————————— *\n *                                                                                  *\n *                                         ▲                                        *\n *                                        ▲ ▲                                       *\n *                                                                                  *\n * ———————————————————————————————————————————————————————————————————————————————— *\n * dTRINITY Protocol: https://github.com/dtrinity                                   *\n * ———————————————————————————————————————————————————————————————————————————————— */\n\npragma solidity ^0.8.20;\n\nimport \"../../oracle_aggregator/interface/chainlink/IAggregatorV3Interface.sol\";\n\n/**\n * @title MockChainlinkAggregator\n * @notice Mock implementation of Chainlink AggregatorV3Interface for testing\n * @dev Provides full mock functionality for testing decimal converters\n */\ncontract MockChainlinkAggregator is AggregatorV3Interface {\n    struct RoundData {\n        uint80 roundId;\n        int256 answer;\n        uint256 startedAt;\n        uint256 updatedAt;\n        uint80 answeredInRound;\n    }\n\n    string private _description;\n    uint8 private _decimals;\n    uint256 private _version;\n\n    mapping(uint80 => RoundData) private rounds;\n    RoundData private latestRound;\n\n    constructor(string memory description_, uint8 decimals_, uint256 version_) {\n        _description = description_;\n        _decimals = decimals_;\n        _version = version_;\n    }\n\n    function description() external view override returns (string memory) {\n        return _description;\n    }\n\n    function version() external view override returns (uint256) {\n        return _version;\n    }\n\n    function decimals() external view override returns (uint8) {\n        return _decimals;\n    }\n\n    function getRoundData(\n        uint80 _roundId\n    )\n        external\n        view\n        override\n        returns (\n            uint80 roundId,\n            int256 answer,\n            uint256 startedAt,\n            uint256 updatedAt,\n            uint80 answeredInRound\n        )\n    {\n        RoundData memory round = rounds[_roundId];\n        require(round.roundId != 0, \"No data for round\");\n\n        return (\n            round.roundId,\n            round.answer,\n            round.startedAt,\n            round.updatedAt,\n            round.answeredInRound\n        );\n    }\n\n    function latestRoundData()\n        external\n        view\n        override\n        returns (\n            uint80 roundId,\n            int256 answer,\n            uint256 startedAt,\n            uint256 updatedAt,\n            uint80 answeredInRound\n        )\n    {\n        return (\n            latestRound.roundId,\n            latestRound.answer,\n            latestRound.startedAt,\n            latestRound.updatedAt,\n            latestRound.answeredInRound\n        );\n    }\n\n    /**\n     * @notice Set mock data for latest round\n     * @param roundId The round ID\n     * @param answer The price answer\n     * @param startedAt Timestamp when round started\n     * @param updatedAt Timestamp when round was updated\n     * @param answeredInRound Round in which answer was computed\n     */\n    function setLatestRoundData(\n        uint80 roundId,\n        int256 answer,\n        uint256 startedAt,\n        uint256 updatedAt,\n        uint80 answeredInRound\n    ) external {\n        latestRound = RoundData({\n            roundId: roundId,\n            answer: answer,\n            startedAt: startedAt,\n            updatedAt: updatedAt,\n            answeredInRound: answeredInRound\n        });\n\n        // Also store in rounds mapping\n        rounds[roundId] = latestRound;\n    }\n\n    /**\n     * @notice Set mock data for a specific round\n     * @param roundId The round ID\n     * @param answer The price answer\n     * @param startedAt Timestamp when round started\n     * @param updatedAt Timestamp when round was updated\n     * @param answeredInRound Round in which answer was computed\n     */\n    function setRoundData(\n        uint80 roundId,\n        int256 answer,\n        uint256 startedAt,\n        uint256 updatedAt,\n        uint80 answeredInRound\n    ) external {\n        rounds[roundId] = RoundData({\n            roundId: roundId,\n            answer: answer,\n            startedAt: startedAt,\n            updatedAt: updatedAt,\n            answeredInRound: answeredInRound\n        });\n    }\n}\n"
    }
  },
  "settings": {
    "optimizer": {
      "enabled": true,
      "runs": 200
    },
    "viaIR": true,
    "evmVersion": "paris",
    "outputSelection": {
      "*": {
        "*": [
          "abi",
          "evm.bytecode",
          "evm.deployedBytecode",
          "evm.methodIdentifiers",
          "metadata",
          "devdoc",
          "userdoc",
          "storageLayout",
          "evm.gasEstimates"
        ],
        "": [
          "ast"
        ]
      }
    },
    "metadata": {
      "useLiteralContent": true
    }
  }
}